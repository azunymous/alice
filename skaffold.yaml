apiVersion: skaffold/v1
kind: Config
metadata:
  name: alice
build:
  artifacts:
  - image: gcr.io/alice-ws/test/alice
    context: api
  - image: gcr.io/alice-ws/test/alice-web
    context: web
    docker:
      dockerfile: development.Dockerfile
deploy:
  kustomize:
    path: ./platform/development
profiles:
- name: test
  build:
    artifacts:
    - image: gcr.io/alice-ws/test/alice
      context: api
    - image: gcr.io/alice-ws/test/alice-ft
      context: testing/apitest
  deploy:
    kustomize:
      path: ./platform/kustomize/test/
- name: test-local
  build:
    artifacts:
      - image: gcr.io/alice-ws/test/alice
        context: api
  deploy:
    kustomize:
      path: ./platform/kustomize/test/local
  portForward:
    - resourceType: service
      resourceName: alice
      namespace: alice-local
      port: 80
      localPort: 8080
    - resourceType: service
      resourceName: redis
      namespace: alice-local
      port: 6379
    - resourceType: service
      resourceName: minio
      namespace: alice-local
      port: 9000
- name: api
  build:
    artifacts:
    - image: gcr.io/alice-ws/test/alice
      context: api
  deploy:
    kustomize:
      path: ./platform/kustomize/api/development
- name: web
  build:
    artifacts:
    - image: gcr.io/alice-ws/test/alice-web
      context: web
  deploy:
    kustomize:
      path: ./platform/kustomize/web/development
- name: minio-cluster
  deploy:
    kustomize:
      path: ./platform/kustomize/minio/development-distributed
- name: redis-cluster
  deploy:
    kustomize:
      path: ./platform/kustomize/redis/distributed
- name: andromeda
  deploy:
    kustomize:
      path: ./platform/andromeda
- name: production
  build:
    artifacts:
      - image: gcr.io/alice-ws/production/alice
        context: api
      - image: gcr.io/alice-ws/production/alice-web
        context: web
  deploy:
    kustomize:
      path: ./platform/production
